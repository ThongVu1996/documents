<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550" style="background: #0f172a; font-family: 'Segoe UI', sans-serif;">
  <defs>
    <!-- Filters -->
    <filter id="box-shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
      <path d="M0 0 L6 3 L0 6 Z" fill="#64748b" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="30" fill="#94a3b8" font-size="18" font-weight="bold" text-anchor="middle" letter-spacing="2">MULTI-REGION &amp; SCALING ARCHITECTURE (Lab #2)</text>

  <!-- GLOBAL CONTROL PLANE -->
  <g transform="translate(50, 70)">
     <rect x="0" y="0" width="800" height="100" rx="10" fill="rgba(30, 41, 59, 0.5)" stroke="#475569" stroke-dasharray="2 2"/>
     <text x="400" y="25" fill="#e2e8f0" font-size="14" font-weight="bold" text-anchor="middle">GLOBAL SCOPE (Terraform Control)</text>

     <!-- IAM Users (For Each) -->
     <g transform="translate(450, 40)">
         <rect x="0" y="0" width="200" height="40" rx="5" fill="#8b5cf6" stroke="#a78bfa"/>
         <text x="100" y="25" fill="#fff" font-size="12" font-weight="bold" text-anchor="middle">IAM Users (for_each)</text>
         <!-- Bubbles for users -->
         <circle cx="-20" cy="20" r="15" fill="#a78bfa" opacity="0.5"/>
         <text x="-20" y="24" fill="#fff" font-size="10" text-anchor="middle">Alice</text>
         <circle cx="220" cy="20" r="15" fill="#a78bfa" opacity="0.5"/>
         <text x="220" y="24" fill="#fff" font-size="10" text-anchor="middle">Bob</text>
     </g>

     <!-- Random Provider -->
     <g transform="translate(150, 40)">
          <path d="M0 0 L150 0 L140 40 L-10 40 Z" fill="#64748b" stroke="#94a3b8"/>
          <text x="70" y="25" fill="#fff" font-size="12" font-weight="bold" text-anchor="middle">Random ID</text>
          <text x="160" y="25" fill="#64748b" font-family="monospace">suffix: "a1b2"</text>
     </g>
  </g>

  <!-- REGION 1: SINGAPORE -->
  <g transform="translate(50, 200)">
      <rect x="0" y="0" width="500" height="300" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="2" filter="url(#box-shadow)"/>
      <text x="20" y="30" fill="#60a5fa" font-size="16" font-weight="bold">REGION 1: SINGAPORE (ap-southeast-1)</text>

      <!-- Security Group -->
      <g transform="translate(30, 60)">
          <rect x="0" y="0" width="440" height="220" rx="5" fill="rgba(59, 130, 246, 0.1)" stroke="#3b82f6" stroke-dasharray="5 5"/>
          <text x="10" y="20" fill="#60a5fa" font-size="12">VPC / Security Group</text>

          <!-- Key Pair (Positioned lower to avoid overlap) -->
          <g transform="translate(20, 175)">
              <rect x="0" y="0" width="100" height="30" rx="3" fill="#fbbf24" stroke="#d97706"/>
              <text x="50" y="20" fill="#92400e" font-size="10" font-weight="bold" text-anchor="middle">Key Pair</text>
          </g>

          <!-- EC2 Instances (Count) - Moved UP -->
          <g transform="translate(150, 20)">
              <!-- Instance 1 -->
              <g transform="translate(0, 0)">
                  <rect x="0" y="0" width="120" height="140" rx="5" fill="#0f172a" stroke="#22d3ee" stroke-width="2"/>
                  <text x="60" y="20" fill="#22d3ee" font-size="12" font-weight="bold" text-anchor="middle">WebServer #0</text>
                  <line x1="10" y1="30" x2="110" y2="30" stroke="#22d3ee" opacity="0.5"/>
                  <text x="60" y="70" fill="#94a3b8" font-size="10" text-anchor="middle">Nginx Running</text>
              </g>

              <!-- Instance 2 -->
              <g transform="translate(140, 0)">
                  <rect x="0" y="0" width="120" height="140" rx="5" fill="#0f172a" stroke="#22d3ee" stroke-width="2"/>
                  <text x="60" y="20" fill="#22d3ee" font-size="12" font-weight="bold" text-anchor="middle">WebServer #1</text>
                  <line x1="10" y1="30" x2="110" y2="30" stroke="#22d3ee" opacity="0.5"/>
                  <text x="60" y="70" fill="#94a3b8" font-size="10" text-anchor="middle">Nginx Running</text>
                  
                  <!-- Badge for COUNT -->
                  <g transform="translate(80, 120)">
                       <circle r="12" fill="#ef4444"/>
                       <text x="0" y="4" fill="white" font-size="10" font-weight="bold" text-anchor="middle">xN</text>
                  </g>
              </g>
          </g>
      </g>
  </g>


  <!-- REGION 2: VIRGINIA (DR) -->
  <g transform="translate(580, 200)">
      <rect x="0" y="0" width="270" height="300" rx="10" fill="#1e293b" stroke="#f472b6" stroke-width="2" filter="url(#box-shadow)"/>
      <text x="20" y="30" fill="#f472b6" font-size="14" font-weight="bold">REGION 2: VIRGINIA</text>
      <text x="20" y="50" fill="#fbcfe8" font-size="10">(Alias: dr_region)</text>

      <!-- Key Pair Copy -->
      <g transform="translate(85, 120)">
           <!-- Connection Arrow (Curved BELOW servers) -->
           <!-- Path starts from Key Pair in Reg 1 (Abs X=200, Y=450) -->
           <!-- Target is inside this group (Abs X=665, Y=320) -->
           <!-- Relative Start: X = 200 - 665 = -465. Y = 450 - 320 = 130. -->
           <!-- Control Point: (Relative -200, 180) -> Absolute Y approx 500 (Below servers) -->
           
           <path d="M-465 130 Q -265 190 0 30" fill="none" stroke="#fbbf24" stroke-width="2" stroke-dasharray="5 5" marker-end="url(#arrow)">
               <animate attributeName="stroke-dashoffset" from="10" to="0" dur="2s" repeatCount="indefinite"/>
           </path>
           
          <rect x="0" y="0" width="100" height="60" rx="5" fill="#fbbf24" stroke="#d97706" opacity="0.8"/>
          <text x="50" y="25" fill="#92400e" font-size="12" font-weight="bold" text-anchor="middle">DR Key Pair</text>
          <text x="50" y="45" fill="#92400e" font-size="10" text-anchor="middle">(Replicated)</text>
      </g>
  </g>

</svg>
