<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 650" style="background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%); font-family: 'Segoe UI', sans-serif;">
  <defs>
    <filter id="glow-fx-unique-99">
      <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L0,10 L10,5 z" fill="context-stroke" />
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L0,10 L10,5 z" fill="context-stroke" />
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L0,10 L10,5 z" fill="context-stroke" />
    </marker>
    <marker id="arrowRedFwd" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0,0 L0,10 L10,5 z" fill="context-stroke" />
    </marker>
  </defs>

  <style>
    /* Fonts */
    .title { font-size: 24px; fill: #e2e8f0; font-weight: 700; }
    .subtitle { font-size: 14px; fill: #a0aec0; }
    .node-text { font-size: 16px; fill: #e2e8f0; font-weight: 600; }
    .label-text { font-size: 11px; fill: #a0aec0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .sidebar-text { font-size: 12px; fill: #718096; }
    
    /* Shapes */
    .node-box { fill: #1a202c; stroke-width: 2; rx: 8; filter: url(#glow-fx-unique-99); }
    
    /* Connector Lines - M·∫∑c ƒë·ªãnh ·∫©n */
    .connector-line { fill: none; stroke: #718096 ; stroke-width: 2; opacity: 0; } 
    
    /* Packet Styles */
    .packet-rect { rx: 4; stroke-width: 1; }
    .packet-text { 
        font-family: 'Consolas', monospace; 
        font-size: 11px; 
        font-weight: 800; 
        dominant-baseline: middle; 
        text-anchor: middle; 
        fill: #ffffff; 
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
    }

    /* --- ANIMATIONS --- */
    
    /* Sidebar Text Highlights */
    @keyframes s1 { 0%, 25% { fill: #fbbf24; font-weight: 700; } 25.1%, 100% { fill: #718096; font-weight: 400; } }
    @keyframes s2 { 0%, 25% { fill: #718096; font-weight: 400; } 25.1%, 40% { fill: #fbbf24; font-weight: 700; } 40.1%, 100% { fill: #718096; font-weight: 400; } }
    @keyframes s3 { 0%, 40% { fill: #718096; font-weight: 400; } 40.1%, 60% { fill: #48bb78; font-weight: 700; } 60.1%, 100% { fill: #718096; font-weight: 400; } }
    @keyframes s4 { 0%, 75% { fill: #718096; font-weight: 400; } 75.1%, 100% { fill: #fc8181; font-weight: 700; } }

    /* Path Lighting (Neon Effect) */
    @keyframes lightUpBlue { 
        0% { opacity: 0; } 
        1% { opacity: 1; stroke: #63b3ed; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(66, 153, 225, 0.9)); }
        20% { opacity: 1; stroke: #63b3ed; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(66, 153, 225, 0.9)); }
        21% { opacity: 0; filter: none; stroke-width: 2; } 
        100% { opacity: 0; } 
    }
    @keyframes lightUpGreen { 
        0%, 20% { opacity: 0; } 
        21% { opacity: 1; stroke: #68d391; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(72, 187, 120, 0.9)); }
        35% { opacity: 1; stroke: #68d391; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(72, 187, 120, 0.9)); }
        36% { opacity: 0; filter: none; stroke-width: 2; }
        100% { opacity: 0; } 
    }
    @keyframes lightUpBlue2 { 
        0%, 35% { opacity: 0; } 
        36% { opacity: 1; stroke: #63b3ed; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(66, 153, 225, 0.9)); }
        50% { opacity: 1; stroke: #63b3ed; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(66, 153, 225, 0.9)); }
        51% { opacity: 0; filter: none; stroke-width: 2; }
        100% { opacity: 0; } 
    }
    @keyframes lightUpGreen2 { 
        0%, 50% { opacity: 0; } 
        51% { opacity: 1; stroke: #68d391; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(72, 187, 120, 0.9)); }
        65% { opacity: 1; stroke: #68d391; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(72, 187, 120, 0.9)); }
        66% { opacity: 0; filter: none; stroke-width: 2; }
        100% { opacity: 0; } 
    }
    @keyframes lightUpRed { 
        0%, 75% { opacity: 0; } 
        76% { opacity: 1; stroke: #feb2b2; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(252, 129, 129, 0.9)); }
        85% { opacity: 1; stroke: #feb2b2; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(252, 129, 129, 0.9)); }
        86% { opacity: 0; filter: none; stroke-width: 2; }
        100% { opacity: 0; } 
    }
    @keyframes lightUpRed2 { 
        0%, 85% { opacity: 0; } 
        86% { opacity: 1; stroke: #feb2b2; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(252, 129, 129, 0.9)); }
        95% { opacity: 1; stroke: #feb2b2; stroke-width: 4; filter: drop-shadow(0 0 8px rgba(252, 129, 129, 0.9)); }
        96% { opacity: 0; filter: none; stroke-width: 2; }
        100% { opacity: 0; } 
    }

    /* Packet Movements */
    @keyframes moveStep1 {
        0%, 1% { opacity: 0; transform: translate(0, 0); }
        2% { opacity: 1; }
        20% { transform: translate(260px, 0); opacity: 1; }
        21%, 100% { opacity: 0; transform: translate(260px, 0); }
    }
    @keyframes moveStep1_Res {
        0%, 20% { opacity: 0; transform: translate(0, 0); }
        21% { opacity: 1; }
        35% { transform: translate(-260px, 0); opacity: 1; }
        36%, 100% { opacity: 0; transform: translate(-260px, 0); }
    }
    @keyframes moveStep2 {
        0%, 35% { opacity: 0; transform: translate(0, 0); }
        36% { opacity: 1; }
        50% { transform: translate(260px, 0); opacity: 1; }
        51%, 100% { opacity: 0; transform: translate(260px, 0); }
    }
    @keyframes moveStep3 {
        0%, 50% { opacity: 0; transform: translate(0, 0); }
        51% { opacity: 1; }
        65% { transform: translate(-260px, 0); opacity: 1; }
        66%, 100% { opacity: 0; transform: translate(-260px, 0); }
    }
    @keyframes moveStep4 {
        0%, 75% { opacity: 0; transform: translate(0, 0); }
        76% { opacity: 1; }
        85% { transform: translate(260px, 0); opacity: 1; }
        86%, 100% { opacity: 0; transform: translate(260px, 0); }
    }
    @keyframes moveStep5 {
        0%, 85% { opacity: 0; transform: translate(0, 0); }
        86% { opacity: 1; }
        95% { transform: translate(-260px, 0); opacity: 1; }
        96%, 100% { opacity: 0; transform: translate(-260px, 0); }
    }

    /* Extra Animations */
    @keyframes showLogout { 0%, 92% { opacity: 0; transform: scale(0.9); } 93%, 100% { opacity: 1; transform: scale(1); } }
    @keyframes showA { 0%, 5% { opacity: 0.2; } 6%, 20% { opacity: 1; transform: scale(1.02); } 21%, 100% { opacity: 0.2; transform: scale(1); } }
    @keyframes showB { 0%, 35% { opacity: 0.2; } 36%, 50% { opacity: 1; transform: scale(1.02); } 51%, 100% { opacity: 0.2; transform: scale(1); } }
    @keyframes showC { 0%, 75% { opacity: 0.2; } 76%, 100% { opacity: 1; transform: scale(1.02); } }
    @keyframes drainGrace {
        0%, 20% { stroke-dashoffset: 0; opacity: 0; }
        21% { opacity: 1; stroke: #48bb78; }
        50% { stroke: #fbbf24; }
        70% { stroke-dashoffset: 157; stroke: #fc8181; opacity: 1; }
        71%, 100% { stroke-dashoffset: 157; opacity: 0; }
    }
    @keyframes showGraceText { 0%, 20% { opacity: 0; } 21%, 70% { opacity: 1; } 71%, 100% { opacity: 0; } }

  </style>

  <text x="500" y="40" text-anchor="middle" class="title">üõ°Ô∏è Grace Period Pattern</text>
  <text x="500" y="65" text-anchor="middle" class="subtitle">An to√†n cho User (M·∫°ng lag, Double tabs) - Nghi√™m kh·∫Øc v·ªõi Hacker</text>

  <g transform="translate(20, 90)">
    <rect x="0" y="0" width="240" height="420" rx="8" fill="rgba(26, 32, 44, 0.8)" stroke="#4a5568" stroke-width="2" />
    <text x="120" y="30" text-anchor="middle" class="label-text" fill="#9f7aea" text-decoration="underline">Event Log</text>
    
    <g transform="translate(15, 60)">
        <text y="0" class="sidebar-text" style="animation: s1 20s infinite">1. Tab A Refresh</text>
        <text y="15" class="sidebar-text" font-style="italic" fill="#718096" style="animation: s1 20s infinite">‚Üí Sent: RT_1</text>
        <text y="30" class="sidebar-text" font-style="italic" fill="#48bb78" style="animation: s1 20s infinite">Result: OK, Timer Started</text>
    </g>
    <g transform="translate(15, 120)">
        <text y="0" class="sidebar-text" style="animation: s2 20s infinite">2. Tab B Refresh (Lag)</text>
        <text y="15" class="sidebar-text" font-style="italic" fill="#fbbf24" style="animation: s2 20s infinite">‚ö† Duplicate: RT_1</text>
        <text y="30" class="sidebar-text" font-style="italic" fill="#718096" style="animation: s2 20s infinite">Check: &lt; 10s Grace?</text>
    </g>
    <g transform="translate(15, 180)">
        <text y="0" class="sidebar-text" style="animation: s3 20s infinite">3. Server Response</text>
        <text y="15" class="sidebar-text" font-style="italic" fill="#48bb78" style="animation: s3 20s infinite">‚Üí Sent: 200 OK (New Tokens)</text>
    </g>
    <line x1="10" y1="220" x2="230" y2="220" stroke="#4a5568" stroke-width="1"/>
    <g transform="translate(15, 250)">
        <text y="0" class="sidebar-text" style="animation: s4 20s infinite">4. Hacker Attack</text>
        <text y="15" class="sidebar-text" font-style="italic" fill="#fc8181" style="animation: s4 20s infinite">‚ö† Duplicate: RT_1 (Expired)</text>
        <text y="30" class="sidebar-text" font-style="italic" fill="#718096" style="animation: s4 20s infinite">Action: Revoke All</text>
        <text y="45" class="sidebar-text" font-weight="bold" fill="#fc8181" style="animation: s4 20s infinite">üö® CLIENT LOGOUT</text>
    </g>
  </g>

  <g transform="translate(280, 90)">
    <rect width="200" height="420" class="node-box" stroke="#4299e1"/>
    <text x="100" y="30" text-anchor="middle" class="node-text" fill="#63b3ed">User Browser</text>
    
    <rect x="20" y="60" width="160" height="60" rx="4" fill="#2d3748" stroke="#4a5568"/>
    <text x="30" y="85" class="label-text" fill="#e2e8f0">TAB A</text>
    <text x="30" y="105" class="sidebar-text" fill="#718096">Token: RT_1</text>
    
    <rect x="20" y="180" width="160" height="60" rx="4" fill="#2d3748" stroke="#4a5568"/>
    <text x="30" y="205" class="label-text" fill="#e2e8f0">TAB B (Lag)</text>
    <text x="30" y="225" class="sidebar-text" fill="#718096">Token: RT_1</text>
    
    <rect x="20" y="320" width="160" height="60" rx="4" fill="#2c0b0e" stroke="#fc8181"/>
    <text x="30" y="345" class="label-text" fill="#fc8181">HACKER</text>
    <text x="30" y="365" class="sidebar-text" fill="#fc8181">Stolen: RT_1</text>

    <g style="animation: showLogout 20s infinite">
        <rect x="0" y="0" width="200" height="420" rx="12" fill="rgba(20, 0, 0, 0.85)" stroke="#fc8181" stroke-width="4"/>
        <text x="100" y="200" text-anchor="middle" font-size="28" fill="#fc8181">‚ö†</text>
        <text x="100" y="230" text-anchor="middle" class="node-text" fill="#fc8181">LOGGED OUT</text>
        <text x="100" y="250" text-anchor="middle" class="sidebar-text" fill="#fff">Session Revoked</text>
    </g>
  </g>

  <g transform="translate(740, 90)">
    <rect width="220" height="420" class="node-box" stroke="#9f7aea"/>
    <text x="20" y="40" text-anchor="start" class="node-text" fill="#9f7aea">Auth Server</text>
    
    <g transform="translate(170, 35)">
         <circle cx="0" cy="0" r="22" fill="none" stroke="#2d3748" stroke-width="4"/>
         <circle cx="0" cy="0" r="22" fill="none" stroke-width="4" stroke-linecap="round" stroke-dasharray="138" transform="rotate(-90)" style="animation: drainGrace 20s linear infinite;"/>
         <text x="0" y="5" text-anchor="middle" class="label-text" fill="#48bb78" style="animation: showGraceText 20s infinite">10s</text>
    </g>
    
    <g transform="translate(20, 50)">
         <rect width="180" height="80" rx="4" fill="#2d3748" stroke="#48bb78" style="animation: showA 20s infinite"/>
         <text x="10" y="25" class="label-text" fill="#48bb78">Case 1: Valid</text>
         <text x="10" y="45" class="sidebar-text" fill="#e2e8f0">‚úì Rotated RT</text>
         <text x="10" y="60" class="sidebar-text" fill="#e2e8f0">‚úì Start Timer</text>
    </g>
    
    <g transform="translate(20, 170)">
         <rect width="180" height="80" rx="4" fill="#2d3748" stroke="#fbbf24" style="animation: showB 20s infinite"/>
         <text x="10" y="25" class="label-text" fill="#fbbf24">Case 2: Grace Period</text>
         <text x="10" y="45" class="sidebar-text" fill="#e2e8f0">‚ö† Reused RT_1</text>
         <text x="10" y="60" class="sidebar-text" fill="#e2e8f0">‚úì Under 10s: Allow</text>
    </g>

    <g transform="translate(20, 310)">
         <rect width="180" height="80" rx="4" fill="#2c0b0e" stroke="#fc8181" style="animation: showC 20s infinite"/>
         <text x="10" y="25" class="label-text" fill="#fc8181">Case 3: Attack</text>
         <text x="10" y="45" class="sidebar-text" fill="#fc8181">‚ö† Reused RT_1</text>
         <text x="10" y="60" class="sidebar-text" fill="#fc8181">‚ùå Revoke All</text>
    </g>
  </g>

  <g transform="translate(480, 180)">
      <path d="M0,0 L260,0" class="connector-line" style="animation: lightUpBlue 20s infinite" marker-end="url(#arrowBlue)"/>
      <g style="animation: moveStep1 20s infinite">
          <rect x="-40" y="-12" width="80" height="24" fill="#63b3ed" class="packet-rect" stroke="#2b6cb0"/>
          <text x="0" y="1" class="packet-text">1. RT_1</text>
      </g>
  </g>
  
  <g transform="translate(740, 180)">
      <path d="M0,0 L-260,0" class="connector-line" style="animation: lightUpGreen 20s infinite" marker-end="url(#arrowGreen)"/>
      <g style="animation: moveStep1_Res 20s infinite">
          <rect x="-40" y="-12" width="80" height="24" fill="#68d391" class="packet-rect" stroke="#276749"/>
          <text x="0" y="1" class="packet-text">200 OK</text>
      </g>
  </g>

  <g transform="translate(480, 300)">
      <path d="M0,0 L260,0" class="connector-line" style="animation: lightUpBlue2 20s infinite" marker-end="url(#arrowBlue)"/>
      <g style="animation: moveStep2 20s infinite">
          <rect x="-40" y="-12" width="80" height="24" fill="#90cdf4" class="packet-rect" stroke="#2b6cb0"/>
          <text x="0" y="1" class="packet-text">2. RT_1</text>
      </g>
  </g>

  <g transform="translate(740, 300)">
      <path d="M0,0 L-260,0" class="connector-line" style="animation: lightUpGreen2 20s infinite" marker-end="url(#arrowGreen)"/>
      <g style="animation: moveStep3 20s infinite">
          <rect x="-40" y="-12" width="80" height="24" fill="#68d391" class="packet-rect" stroke="#276749"/>
          <text x="0" y="1" class="packet-text">3. New AT</text>
      </g>
  </g>

  <g transform="translate(480, 440)">
      <path d="M0,0 L260,0" class="connector-line" style="animation: lightUpRed 20s infinite" marker-end="url(#arrowRedFwd)"/>
      <g style="animation: moveStep4 20s infinite">
          <rect x="-40" y="-12" width="80" height="24" fill="#fc8181" class="packet-rect" stroke="#9b2c2c"/>
          <text x="0" y="1" class="packet-text">4. RT_1</text>
      </g>
  </g>

  <g transform="translate(740, 440)">
      <path d="M0,0 L-260,0" class="connector-line" style="animation: lightUpRed2 20s infinite" marker-end="url(#arrowRed)"/>
      <g style="animation: moveStep5 20s infinite">
          <rect x="-40" y="-12" width="90" height="24" fill="#e53e3e" class="packet-rect" stroke="#742a2a"/>
          <text x="0" y="1" class="packet-text" fill="#fff">5. REVOKE</text>
      </g>
  </g>

</svg>