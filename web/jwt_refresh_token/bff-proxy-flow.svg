<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 750" style="background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);">
  <defs>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="shieldGlow">
      <feDropShadow dx="0" dy="0" stdDeviation="5" flood-color="#9f7aea" />
    </filter>
    
    <!-- Markers -->
    <marker id="arrowBlue" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L10,3 z" fill="#4299e1" />
    </marker>
    <marker id="arrowRed" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L10,3 z" fill="#fc8181" />
    </marker>
    <marker id="arrowPurple" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L10,3 z" fill="#9f7aea" />
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L10,3 z" fill="#48bb78" />
    </marker>
  </defs>
  
  <style>
    /* Typography */
    .title { font-family: 'Segoe UI', sans-serif; font-size: 32px; fill: #e2e8f0; font-weight: 700; }
    .subtitle { font-family: 'Segoe UI', sans-serif; font-size: 18px; fill: #a0aec0; }
    .node-text { font-family: 'Segoe UI', sans-serif; font-size: 14px; fill: #1a202c; font-weight: 700; }
    .node-text-light { font-family: 'Segoe UI', sans-serif; font-size: 16px; fill: #e2e8f0; font-weight: 700; }
    .step-num { font-family: 'Segoe UI', sans-serif; font-size: 12px; fill: #fff; font-weight: 700; }
    .step-text { font-family: 'Segoe UI', sans-serif; font-size: 11px; fill: #cbd5e0; font-weight: 500; }
    .sidebar-title { font-family: 'Segoe UI', sans-serif; font-size: 18px; fill: #9f7aea; font-weight: 600; text-decoration: underline; }
    .sidebar-text { font-family: 'Segoe UI', sans-serif; font-size: 14px; fill: #718096; transition: all 0.5s; }
    
    /* Animation Cycle: 18s total */
    .s1 { opacity: 0.1; animation: hlBlue 18s ease-in-out infinite; animation-delay: 0s; } /* Client -> BFF */
    .s2 { opacity: 0.1; animation: hlRed 18s ease-in-out infinite; animation-delay: 3s; }  /* BFF -> Redis */
    .s3 { opacity: 0.1; animation: hlRed 18s ease-in-out infinite; animation-delay: 6s; }  /* Redis -> BFF */
    /* Step 4 Removed (Swap) */
    .s4 { opacity: 0.1; animation: hlPurple 18s ease-in-out infinite; animation-delay: 9s; } /* Forward (Was s5) */
    .s5 { opacity: 0.1; animation: hlGreen 18s ease-in-out infinite; animation-delay: 12s; } /* API -> BFF (Was s6) */
    .s6 { opacity: 0.1; animation: hlGreen 18s ease-in-out infinite; animation-delay: 15s; } /* BFF -> Client (Was s7) */

    /* Sidebar Highlight */
    .txt-s1 { animation: txtHlBlue 18s ease-in-out infinite; animation-delay: 0s; }
    .txt-s2 { animation: txtHlRed 18s ease-in-out infinite; animation-delay: 3s; }
    .txt-s3 { animation: txtHlRed 18s ease-in-out infinite; animation-delay: 6s; }
    .txt-s4 { animation: txtHlPurple 18s ease-in-out infinite; animation-delay: 9s; }
    .txt-s5 { animation: txtHlGreen 18s ease-in-out infinite; animation-delay: 12s; }
    .txt-s6 { animation: txtHlGreen 18s ease-in-out infinite; animation-delay: 15s; }
    
    /* Keyframes */
    @keyframes hlBlue { 0%,10% { opacity:1; filter:drop-shadow(0 0 8px rgba(66,153,225,1)); stroke-width:3; } 14%,100% { opacity:0.1; stroke-width:1; } }
    @keyframes hlPurple { 0%,10% { opacity:1; filter:drop-shadow(0 0 8px rgba(159,122,234,1)); stroke-width:3; } 14%,100% { opacity:0.1; stroke-width:1; } }
    @keyframes hlRed { 0%,10% { opacity:1; filter:drop-shadow(0 0 8px rgba(252,129,129,1)); stroke-width:3; } 14%,100% { opacity:0.1; stroke-width:1; } }
    @keyframes hlGreen { 0%,10% { opacity:1; filter:drop-shadow(0 0 8px rgba(72,187,120,1)); stroke-width:3; } 14%,100% { opacity:0.1; stroke-width:1; } }

    @keyframes txtHlBlue { 0%,10% { fill: #63b3ed; font-weight:700; transform: translateX(10px); } 14%,100% { fill: #718096; transform: translateX(0); } }
    @keyframes txtHlPurple { 0%,10% { fill: #b794f4; font-weight:700; transform: translateX(10px); } 14%,100% { fill: #718096; transform: translateX(0); } }
    @keyframes txtHlRed { 0%,10% { fill: #fc8181; font-weight:700; transform: translateX(10px); } 14%,100% { fill: #718096; transform: translateX(0); } }
    @keyframes txtHlGreen { 0%,10% { fill: #68d391; font-weight:700; transform: translateX(10px); } 14%,100% { fill: #718096; transform: translateX(0); } }

    .indicator { animation: pulse 1s ease-in-out infinite; }
    @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.2); } }
  </style>
  
  <text x="600" y="50" text-anchor="middle" class="title">BFF Proxy Flow (Authorization)</text>
  <text x="600" y="80" text-anchor="middle" class="subtitle">Swapping "Public Cookie" for "Secret Token"</text>

  <!-- SIDEBAR (Left) -->
  <g transform="translate(50, 150)">
    <rect x="0" y="0" width="300" height="450" rx="10" fill="rgba(30, 30, 40, 0.5)" stroke="#2d3748" />
    <text x="20" y="40" class="sidebar-title">Detailed Steps</text>
    
    <text x="20" y="80" class="sidebar-text txt-s1">1. Client sends Cookie</text>
    <text x="20" y="120" class="sidebar-text txt-s2">2. BFF queries Redis Swap</text>
    <text x="20" y="160" class="sidebar-text txt-s3">3. Redis returns Token</text>
    <!-- Removed Step 4 (Swap Text) -->
    <text x="20" y="200" class="sidebar-text txt-s4">4. Forward to Backend (Bearer)</text>
    <text x="20" y="240" class="sidebar-text txt-s5">5. Backend returns Data</text>
    <text x="20" y="280" class="sidebar-text txt-s6">6. BFF responds to Client</text>
    
    <line x1="20" y1="380" x2="280" y2="380" stroke="#4a5568"/>
    <text x="20" y="410" class="sidebar-text" fill="#a0aec0" font-style="italic">Separation of Concerns used.</text>
  </g>

  <!-- DIAGRAM AREA (Right) -->
  <g transform="translate(400, 100)"> 
    
    <!-- Client -->
    <g transform="translate(50, 250)">
      <rect x="0" y="0" width="140" height="100" rx="40" fill="#2d3748" stroke="#4299e1" stroke-width="3"/>
      <text x="70" y="55" text-anchor="middle" style="font-size:35px">üíª</text>
      <text x="70" y="85" text-anchor="middle" class="node-text-light">Client</text>
    </g>

    <!-- BFF  -->
    <g transform="translate(350, 200)">
      <rect x="0" y="0" width="200" height="200" rx="15" fill="#2d3748" stroke="#9f7aea" stroke-width="3"/>
      <g filter="url(#shieldGlow)">
        <text x="100" y="100" text-anchor="middle" style="font-size:70px;">üõ°Ô∏è</text>
      </g>
      <text x="100" y="150" text-anchor="middle" class="node-text-light" style="font-size:20px;">BFF / Proxy</text>
    </g> 

    <!-- Redis -->
    <g transform="translate(400, 40)">
      <rect x="0" y="0" width="100" height="80" rx="10" fill="#fff5f5" stroke="#fc8181" stroke-width="3"/>
      <text x="50" y="40" text-anchor="middle" style="font-size:30px">üß†</text>
      <text x="50" y="65" text-anchor="middle" class="node-text">Redis</text>
    </g>

    <!-- Backend -->
    <g transform="translate(700, 200)">
      <rect x="0" y="0" width="180" height="200" rx="15" fill="#c6f6d5" stroke="#48bb78" stroke-width="3"/>
      <text x="90" y="100" text-anchor="middle" style="font-size:60px;">‚öôÔ∏è</text>
      <text x="90" y="150" text-anchor="middle" class="node-text">Data API</text>
    </g>

    <!-- LINES -->

    <!-- 1. Client -> BFF -->
    <g class="s1">
        <path d="M 190 280 L 350 280" stroke="#4299e1" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
        <g transform="translate(270, 240)"><circle r="12" fill="#4299e1" class="indicator"/><text x="0" y="4" text-anchor="middle" class="step-num">1</text></g>
        <text x="270" y="270" text-anchor="middle" class="step-text">Cookie: SessionID</text>
    </g>

    <!-- 2. BFF -> Redis (Query) -->
    <g class="s2">
        <path d="M 430 200 L 430 120" stroke="#fc8181" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
        <g transform="translate(390, 150)"><circle r="12" fill="#fc8181" class="indicator"/><text x="0" y="4" text-anchor="middle" class="step-num">2</text></g>
        <text x="425" y="180" text-anchor="end" class="step-text">Send SessionID</text>
    </g>

    <!-- 3. Redis -> BFF (Return) -->
    <g class="s3">
        <path d="M 470 120 L 470 200" stroke="#fc8181" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
        <g transform="translate(500, 150)"><circle r="12" fill="#fc8181" class="indicator"/><text x="0" y="4" text-anchor="middle" class="step-num">3</text></g>
        <text x="480" y="180" text-anchor="start" class="step-text">(AT, RT)</text>
    </g>

    <!-- Removed Step 4 (Swap Icon) Group -->

    <!-- 4. Forward to Backend (Was 5) -->
    <g class="s4">
        <path d="M 550 280 L 700 280" stroke="#9f7aea" stroke-width="2" fill="none" marker-end="url(#arrowPurple)"/>
        <g transform="translate(625, 240)"><circle r="12" fill="#9f7aea" class="indicator"/><text x="0" y="4" text-anchor="middle" class="step-num">4</text></g>
        <text x="625" y="270" text-anchor="middle" class="step-text">Bearer Token</text>
    </g>

    <!-- 5. Backend -> BFF (Was 6) -->
    <g class="s5">
        <path d="M 700 320 L 550 320" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
        <g transform="translate(625, 340)"><circle r="12" fill="#48bb78" class="indicator"/><text x="0" y="4" text-anchor="middle" class="step-num">5</text></g>
        <text x="625" y="370" text-anchor="middle" class="step-text">JSON Response</text>
    </g>

    <!-- 6. BFF -> Client (Was 7) -->
    <g class="s6">
        <path d="M 350 320 L 190 320" stroke="#48bb78" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
        <g transform="translate(270, 340)"><circle r="12" fill="#48bb78" class="indicator"/><text x="0" y="4" text-anchor="middle" class="step-num">6</text></g>
        <text x="270" y="370" text-anchor="middle" class="step-text">Forward Data</text>
    </g>

  </g>
</svg>

